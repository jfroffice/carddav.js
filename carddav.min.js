/*! CardDav JS - v0.0.1 - 2012-04-30
* https://github.com/jfroffice/carddav.js
* Copyright (c) 2012 John Fischer; Licensed MIT */
(function(a,b,c,d){function i(a,b){return"Basic "+c(a+":"+b)}function j(a,b,c,d){a.setRequestHeader("Authorization",i(b,c)),a.setRequestHeader("X-client","webdav.js Client "+e),a.setRequestHeader("Depth",d?"0":d)}"use strict";var e="0.0.1",f=3e4,g={},h={cache:!1,crossDomain:!0,async:!0,xhrFields:{withCredentials:!1},timeout:f,contentType:"text/xml; charset=utf-8",processData:!0,dataType:"xml"};g.version=e,g.propFind=function(a){a=b.extend({},h,a),b.ajax({type:"PROPFIND",url:a.url,data:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:">'+a.data+"</D:propfind>",beforeSend:function(b){j(b,a.user,a.passwd)},error:function(b,c,d){return a.error&&a.error(b,c,d),!1},complete:function(b,c){a.success&&a.success(b,c)}})},g.report=function(a){a=b.extend({},h,a),b.ajax({type:"REPORT",url:a.url,data:a.realData||'<?xml version="1.0" encoding="utf-8"?><D:sync-collection xmlns:D="DAV:">'+a.data+"</D:sync-collection>",beforeSend:function(b){j(b,a.user,a.passwd)},error:function(b,c,d){return a.error&&a.error(b,c,d),!1},complete:function(b,c){a.success&&a.success(b,c)}})},a.webdav=g})(this,jQuery,this.btoa),function(a,b,c){function f(a){var b={simple:/^(version|fn|n|title|org|note|uid|rev|categories)\:(.+)$/i,complex:/^([^\:\;]+);([^\:]+)\:(.+)$/,key:/item\d{1,2}\./,properties:/((type=)?(.+);?)+/},c={},d=a.split("\n"),e={},f={categories:function(a){return a.split(",")},Name:function(a){return a.split(";")}},g,h,i,j,k,l;for(var m in d)d.hasOwnProperty(m)&&(g=d[m],b.simple.test(g)?(h=g.match(b.simple),i=h[1].toLowerCase(),j=h[2],c[e[i]||i]=f[i]?f[i](j):j):b.complex.test(g)&&(h=g.match(b.complex),i=h[1].replace(b.key,"").toLowerCase(),k=h[2].split(";"),l=k.pop()||"default",l=l.toLowerCase(),j=h[3],j=/;/.test(j)?[j.split(";")]:j,c[i]=c[i]||{},c[i][l]=c[i][l]||[],c[i][l]=c[i][l].concat(j)));return c}function g(c,d,e,g){b.report({url:c.url,user:c.user,passwd:c.passwd,realData:d,error:function(a,b,c){e&&e(a,b,c)},success:function(b,d){if(d!=="success"||!c.success)return!1;var e=[];a(b.responseXML).find("response").each(function(){var b=a(this).find("href").text();a(this).find("prop").children().each(function(c){c===1&&e.push({url:b,vcard:f(a(this).text())})})}),g&&g(e)}})}function h(b){var c='<?xml version="1.0" encoding="utf-8"?><E:addressbook-multiget xmlns:E="urn:ietf:params:xml:ns:carddav"><A:prop xmlns:A="DAV:"><A:getetag/><E:address-data/></A:prop>';return a(b.responseXML).find("href").each(function(){c+='<A:href xmlns:A="DAV:">'+a(this).text()+"</A:href>"}),c+"</E:addressbook-multiget>"}"use strict";var d="0.0.1",e={};e.get=function(a){b.report({url:a.url,user:a.user,passwd:a.passwd,data:"<D:sync-token/><D:prop><D:getcontenttype/></D:prop>",error:function(b,c,d){a.error&&a.error(b,c,d)},success:function(b,c){if(c!=="success"||!a.success)return!1;g(a,h(b),a.error,a.success)}})},e.version=d,a.carddav=e}(jQuery,this.webdav);